---

# Variables to hold lookup functions
admin_secret_lookup: "{{ lookup('k8s', kind='Secret', namespace=namespace, resource_name=admin_secret_name) }}"
connect_secret_lookup: "{{ lookup('k8s', kind='Secret', namespace=namespace, resource_name=connect_secret_name) }}"
password_lookup: "{{ lookup('password', '/dev/null') }}"
init_configmap_lookup: "{{ lookup('k8s', kind='ConfigMap', namespace=namespace, resource_name=init_configmap_name) }}"
service_lookup: "{{ lookup('k8s', kind='Service', namespace=namespace, resource_name=service_name) }}"
route_lookup: "{{ lookup('openshift', kind='Route', namespace=namespace, resource_name=route_name) }}"
binaries_pvc_lookup: "{{ lookup('k8s', kind='PersistentVolumeClaim', namespace=namespace, resource_name=binaries_pvc_name) }}"
transientstore_pvc_lookup: "{{ lookup('k8s', kind='PersistentVolumeClaim', namespace=namespace, resource_name=transientstore_pvc_name) }}"
data_pvc_lookup: "{{ lookup('k8s', kind='PersistentVolumeClaim', namespace=namespace, resource_name=data_pvc_name) }}"
log_pvc_lookup: "{{ lookup('k8s', kind='PersistentVolumeClaim', namespace=namespace, resource_name=log_pvc_name) }}"
interactive_dc_lookup: "{{ lookup('openshift', kind='DeploymentConfig', namespace=namespace, resource_name=interactive_dc_name) }}"
worker_dc_lookup: "{{ lookup('openshift', kind='DeploymentConfig', namespace=namespace, resource_name=worker_dc_name) }}"
nginx_configmap_lookup: "{{ lookup('openshift', kind='ConfigMap', namespace=namespace, resource_name=nginx_configmap_name) }}"
nginx_secret_lookup: "{{ lookup('openshift', kind='Secret', namespace=namespace, resource_name=nginx_secret_name) }}"

# Variables to hold queries
ready_replicas_query: "[spec.replicas, status.ready_replicas]"
dc_interactive_query: "{{ interactive_dc_lookup | json_query(ready_replicas_query) | unique | count == 1 }}"
dc_worker_query: "{{ worker_dc_lookup | json_query(ready_replicas_query) | unique | count == 1 }}"
use_front_ssl_proxy: "{{ True if (secure_route_tls_termination_type is defined and secure_route_tls_termination_type != 'edge') else False }}"
has_workers: "{{ True if (worker_replicas is defined and worker_replicas > 0) else False }}"

# Whether we are in a cluster or not.
pod_name: "{{ lookup('env', 'POD_NAME') }}"
pod_namespace: "{{ lookup('env', 'POD_NAMESPACE') }}"
in_cluster: "{{ True if (pod_name and pod_namespace) else False }}"

# Variables to hold resource names
admin_secret_name: "{{ name + '-admin' if auth_existingAdminSecret is undefined else auth_existingAdminSecret }}"
connect_secret_name: "{{ name + '-connect' if connectExistingSecret is undefined else connectExistingSecret }}"
admin_password: "{{ password_lookup if auth_adminPassword is undefined else auth_adminPassword }}"
init_configmap_name: "{{ name + '-config'}}"
service_name: "{{ name + '-service'}}"
route_name: "{{ name + '-route'}}"
binaries_pvc_name: "{{ name + '-binaries-pvc'}}"
transientstore_pvc_name: "{{ name + '-transientstore-pvc'}}"
data_pvc_name: "{{ name + '-data-pvc'}}"
log_pvc_name: "{{ name + '-log-pvc'}}"
interactive_dc_name: "{{ name + '-interactive'}}"
worker_dc_name: "{{ name + '-worker'}}"
nginx_configmap_name: "{{ name + '-nginx-conf'}}"
nginx_secret_name: "{{ name + '-cert-secret'}}"